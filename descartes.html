<!doctype html>
<script src="./descartes.js"></script>
<link rel=stylesheet href="./descartes.css">
<body>
  <div id="main"></div>
  <script>
    (function() {

      var node = (tag, attrs, children) => {
        var node = document.createElement(tag)
        for (var attr in attrs) {
          if (attr === 'style') {
            Object.assign(node.style, attrs[attr])
          } else {
            node.setAttribute(attr, attrs[attr])
          }
        }
        children && children.forEach(child => child && node.appendChild(typeof child === 'string' ? document.createTextNode(child) : child))
        return node
      }
      var named = tag => (attrs, children) => node(tag, attrs, children)
      var div = named('div')
      var span = named('span')
      var a = named('a')
      var raw = (text, tag='div') => {
        var node = document.createElement(tag)
        node.innerHTML = text
        return node
      };

      var render = (target, node) => {
        target.innerHTML = ''
        target.appendChild(node)
      };

      var root = document.getElementById('main')

      render(root, div({}, Object.keys(DATA).map(k => {
        return div({class: 'item' + (DATA[k].values.length === 0 ? ' isolated' : ''), id: 'block-' + k}, [
          node('pre', {class: 'code'}, [raw(DATA[k].html, 'code')]),
          DATA[k].values.length ? div({class: 'uses'}, DATA[k].values.map(({id, name, moduleName}) => (
            div({class: 'use', 'data-global-use': id}, [moduleName + "." + name])
          ))) : null
        ])
      })))

      root.addEventListener('click', evt => {
        var id = evt.target.getAttribute('data-global-use')
        if (id) {
          window.location.hash = '#block-' + id
        }
      })

    })();
  </script>
</body>